A = double(rgb2gray(imread("pic.png")));
[R, C] = size(A);
B = zeros(R, C);

K = 9;
W = [1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81; 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81; 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81; 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81; 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81; 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81; 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81; 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81; 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81 1/81;];
K = 3;
W = [1 -2 1; 1 -2 1; 1 -2 1;];
gap = floor(K / 2);

for i=gap+1:1:R-gap
    for j=gap+1:1:C-gap
        area = A(i-gap:i+gap, j-gap:j+gap);
        area = reshape(area, 1, []);
        w = reshape(W, 1, []);
        sum = 0;
        
        for k=1:1:K^2
            sum = sum + (area(k) * w(k));
        end
        
        B(i, j) = sum;
    end
end

figure();
imshow(A, []);
figure();
imshow(B, []);